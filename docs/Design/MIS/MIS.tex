\documentclass[12pt, titlepage]{article}

\usepackage{amsmath, mathtools}

\usepackage[round]{natbib}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{colortbl}
\usepackage{xr}
\usepackage{hyperref}
\usepackage{longtable}
\usepackage{xfrac}
\usepackage{tabularx}
\usepackage{float}
\usepackage{siunitx}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage[section]{placeins}
\usepackage{caption}
\usepackage{fullpage}

\hypersetup{
bookmarks=true,     % show bookmarks bar?
colorlinks=true,       % false: boxed links; true: colored links
linkcolor=red,          % color of internal links (change box color with linkbordercolor)
citecolor=blue,      % color of links to bibliography
filecolor=magenta,  % color of file links
urlcolor=cyan          % color of external links
}

\usepackage{array}

\externaldocument{../../SRS/SRS}

\input{../../Comments}

\newcommand{\progname}{Program Name}

\begin{document}

\title{Module Interface Specification for Stoichiometry Mass-Mass Program}

\author{Deemah Alomair}

\date{\today}

\maketitle

\pagenumbering{roman}

\section{Revision History}

\begin{tabularx}{\textwidth}{p{3cm}p{2cm}X}
\toprule {\bf Date} & {\bf Version} & {\bf Notes}\\
\midrule
Date 1 & 1.0 & First version of document\\
\bottomrule
\end{tabularx}

~\newpage

\section{Symbols, Abbreviations and Acronyms}

See SRS Documentation  \href{https://github.com/deemaalomair1/CAS741_project/tree/master/docs/SRS}{here}


\newpage

\tableofcontents

\newpage

\pagenumbering{arabic}

\section{Introduction}

The following document details the Module Interface Specifications for
Stoichiometry Mass-Mass Program

Complementary documents include the System Requirement Specifications
and Module Guide.  The full documentation and implementation can be
found \href{https://github.com/deemaalomair1/CAS741_project/tree/master/docs}{here}

\section{Notation}

The structure of the MIS for modules comes from \cite{HoffmanAndStrooper1995},
with the addition that template modules have been adapted from
\cite{GhezziEtAl2003}.  The mathematical notation comes from Chapter 3 of
\cite{HoffmanAndStrooper1995}.  For instance, the symbol := is used for a
multiple assignment statement and conditional rules follow the form $(c_1
\Rightarrow r_1 | c_2 \Rightarrow r_2 | ... | c_n \Rightarrow r_n )$.

The following table summarizes the primitive data types used by SMMP. 

\begin{center}
\renewcommand{\arraystretch}{1.2}
\noindent 
\begin{tabular}{l l p{7.5cm}} 
\toprule 
\textbf{Data Type} & \textbf{Notation} & \textbf{Description}\\ 
\midrule
character & char & a single symbol or digit\\
integer & $\mathbb{Z}$ & a number without a fractional component in (-$\infty$, $\infty$) \\
natural number & $\mathbb{N}$ & a number without a fractional component in [1, $\infty$) \\
real & $\mathbb{R}$ & any number in (-$\infty$, $\infty$)\\
\bottomrule
\end{tabular} 
\end{center}

\noindent
The specification of SMMP  uses some derived data types: sequences, strings, and
tuples. Sequences are lists filled with elements of the same data type. Strings
are sequences of characters. Tuples contain a list of values, potentially of
different types. In addition, SMMP  uses functions, which
are defined by the data types of their inputs and outputs. Local functions are
described by giving their type signature followed by their specification.

\noindent
Since chemical reaction is central to SMMP, the following notation
is introduced in an attempt to simplify the presentation of the MIS.\\

\noindent
Chemical reaction:\\

$c_1R[0]_1 + c_2R[0]_2 = cc_1R[1]_1 + cc_2R[1]_2$\\

where $R[0]_1$ is reactant with known mass, $c_1$ is the coefficient number associated to this reactant ,
$R[0]_2$  is reactant with unknown mass, $c_2$ is the coefficient number associated to this reactant , 
$R[1]_i$ is a product and  $cc_i$ is he coefficient number associated to this
product.  \wss{The name $cc_i$ is confusing.  It looks like $c$ times $c_i$.
  Maybe you could use a name like $d_i$?}

\section{Module Decomposition}

The following table is taken directly from the Module Guide document for this project.

\begin{table}[h!]
\centering
\begin{tabular}{p{0.3\textwidth} p{0.6\textwidth}}
\toprule
\textbf{Level 1} & \textbf{Level 2}\\
\midrule

{Hardware-Hiding} & ~ \\
\midrule

\multirow{4}{0.3\textwidth}{Behaviour-Hiding}  &Input Module \\
& Atomic Mass Module\\
&ReactionT Module\\
& Mass Calculation Module\\
\midrule

\multirow{1}{0.3\textwidth}{Software Decision} & GUI Module\\
\bottomrule

\end{tabular}
\caption{Module Hierarchy}
\label{TblMH}
\end{table}


~\newpage

\section{MIS of Input Module} \label{input} 

\subsection{Module}

Input

\subsection{Uses}

Not Applicable.

\subsection{Syntax}

\subsubsection{Exported Constants}
None.

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
{$input_1$} & Chemical-Reaction: \newline ReactionT & - & MismatchedInput  \\
{$input_2$} & Mass-Value : $\mathbb{R}$ & - &  NegativeMassException  \\
\hline
\end{tabular}
\end{center}

\wss{The input module shouldn't take the input as a ReactionT.  The input should
build the ReactionT from the user's input.  You need a way to translate what the
user works with to the mini-language your program has developed.  As we have
discussed before, a parser is probably more work than you want to invest.  My
advice is that you introduce an environment variable for the screen.  The screen
will provide the information necessary for building the Reaction.  You need to
say what information this is.  This is the point where you can customize your
interface to match your assumptions.  You can decide how many compounds on each
side of the equation.  My advice is that you can build compounds with a set
number of molecules and each molecule is built from a drop down list with all of
your elements and an edit box that accepts a natural number.  I suggest that you
do not have edit boxes for the coefficients, since those are what you are solving for.}
\wss{Your GUI module will hide the details of working with a windowing system,
  widgets etc.  The input module will use this GUI module.}

\subsection{Semantics}

\subsubsection{State Variables}

Reaction : ReactionT
\newline
Mass : $\mathbb{R}$

\subsubsection{Environment Variables}

None. \wss{You want an environment variable for your screen here.}

\subsubsection{Assumptions}

None.

\subsubsection{Access Routine Semantics}

\noindent $input_1$(Chemical-Reaction):
\begin{itemize}
\item transition: Reaction $\coloneqq$ Chemical-Reaction
\item output:  None.
\item exception: exc $\coloneqq$ (Chemical-Reaction $\notin$ ReactionT $\Rightarrow$  MismatchedInput)
\end{itemize}

\wss{This is too simple for building the reaction.  As discussed above, you need
  show how the user's input is translated into the terminology of your program.}

\noindent $input_2$(Mass-Value):
\begin{itemize}
\item transition: Mass  $\coloneqq$ Mass-Value
\item output:  None.
\item exception: exc $\coloneqq$ (Mass-Value $\leq$ 0 $\Rightarrow$  NegativeMassException)
\end{itemize}

\wss{I think you need more than one mass don't you?}

\subsubsection{Local Functions}
 
None.



\newpage

\section{MIS of Atomic Mass Module} \label{Atomic Mass} 

\subsection{Module}

Atomic Mass

\subsection{Uses}

Reaction (Section \ref{Reaction})

\subsection{Syntax}

\subsubsection{Exported Constants}

None.

\subsubsection{Exported Types}

None.


\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
{Atomic-Mass} & e: ElementT & AtomicMass: $\mathbb{R}$ & e $\notin$ ElementT  \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

None.

\subsubsection{Environment Variables}

Atomic Mass library file. \wss{This is not how environment variables are used.
  I suggest you read \citet{HoffmanAndStrooper1995}.  For this module the entry
  should be ``None.''  The only place you will have environment modules is when
  you are getting input from the screen (or a file), or outputting results to the
  screen (or a file).}

\subsubsection{Assumptions}

None.

\subsubsection{Access Routine Semantics}

\noindent Atomic-Mass(e):
\begin{itemize}
\item transition: None.
\item output:  out $\coloneqq$ AtomicMass \wss{AtomicMass on its own is a
    function.  You need to call it with an argument in this case.  Having said
    this, I don't think you really need a local function.  You can define the
    output to match the semantics you have for the local function below.  The
    indirection you have just makes the document more difficult to read.}
\item exception: exc $\coloneqq$ (e $\notin$ ElementT $\Rightarrow$
  no-Atomic-Mass) \wss{Since the input to the modules is of type ElementT, how
    is this condition ever going to be true for their to be an exception?}
\end{itemize}

\subsubsection{Local Functions}
AtomicMass: ElementT $\rightarrow$ $\mathbb{R}$ 
\newline
AtomicMass(e) $\equiv$ ( e= H $\rightarrow$ 1.0079 $\vert$  e= He $\rightarrow$ 4.002 $\vert$...)  

\newpage


\section{MIS of ReactionT Module} \label{Reaction} 

\subsection{Template Module}

Reaction

\subsection{Uses}

 Input (Section \ref{input})

\subsection{Syntax}

\subsubsection{Exported Constants}

None.

\subsubsection{Exported Types}

ReactionT = ?

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
{IsBalanced-Reaction} & Reaction: \newline ReactionT &  B: Boolean  & - \\
\hline
{Balanced-Reaction} & Reaction: \newline ReactionT &  Reaction*: \newline ReactionT  &  ($\neg$ IsBalanced-Reaction(Reaction*))\\
\hline
\end{tabular}
\end{center}

\wss{You need a constructor for your ADT.  The input to this ADT is of the same
  type as the ADT, but how do you create this input?}
\wss{The isBalanced-Reaction should work with self to see if the reaction is
  itself is balanced.  There is no need for an argument.}

\subsection{Semantics}

\subsubsection{State Variables}

R : ReactionT

\subsubsection{Environment Variables}

None.

\subsubsection{Assumptions}

None.

\subsubsection{Access Routine Semantics}

\noindent IsBalanced-Reaction(Reaction):
\begin{itemize}
\item transition: None.
\item output: out $\coloneqq$ ($\forall$( Number-of-Atoms-in-ChemicalEq(R[0],e)
  = Number-of-Atoms-in-ChemicalEq (R[1] ,e ) )$\Rightarrow$ True) \wss{What is
    your dummy variable for the quantification?  The $\Rightarrow$ is used for a
    conditional rule, but you do not have a conditional rule here.  I think I
    know what you are trying to say, but mathematically this does not have the
    correct syntax.}
\item exception: None.
\end{itemize}

\noindent Balanced-Reaction(Reaction):
\begin{itemize}
\item transition: Reaction $\coloneqq$ Reaction*
\item output: None. 
\item exception: exc $\coloneqq$  ($\neg$ IsBalanced-Reaction(Reaction*) $\Rightarrow$ not-balanced)
\end{itemize}

\wss{This is where the most important part of your program happens.  How do you
  balance a chemical reaction?  You should at least have a statement that says
  what will potentially be changed in the reaction.  You need to solve for the
  coefficients such that the reaction is balanced.  You should also say what it
  takes for a unique solution.  Ideally, you will solve so that the coefficients
  are all natural numbers.  However, if you want to simplify, you can have the
  coefficients be real numbers.  I'm not sure you have thought about how you are
  going to balance your equation.  The following web-page gives a nice
  explanation of what is involved:
  \url{https://www.nayuki.io/page/chemical-equation-balancer-javascript}}

\subsubsection{Local Functions}

1. Number-of-Atoms-in-Molecule: MoleculeT  X ElementT $\rightarrow$ $\mathbb{N}$
\newline
Number-of-Atoms-in-Molecule(m,e) $\equiv$ (m.element = e $\rightarrow$ m.number $\vert$ m.element $\neq$ e $\rightarrow$ 0) \\
\newline
2. Number-of-Atoms-in-Compound: CompoundT  X ElementT $\rightarrow$ $\mathbb{N}$
\newline
Number-of-Atoms-in-Compound(C,e) $\equiv$ + (m : MoleculeT$\vert$ m $\in$ C $\cdot$   Number-of-Atoms-in-Molecule(m,e) ) \\
\newline
3. Number-of-Atoms-in-Stoichiometric: StoichiometricT  $\times$ ElementT $\rightarrow$ $\mathbb{N}$
\newline
Number-of-Atoms-in-Stoichiometric(S,e) $\equiv$ (S.coefficient $\cdot$ Number-of-Atoms-in-Compound (S.Compound,e) )  \\
\newline
4. Number-of-Atoms-in-ChemicalEq: ChemicalEqT  X ElementT $\rightarrow$ $\mathbb{N}$
\newline
Number-of-Atoms-in-ChemicalEq (Ce,e) $\equiv$ + (S : StoichiometricT $\vert$ S $\in$ Ce $\cdot$ Number-of-Atoms-in-Stoichiometric(S,e))\\
\newline
5. ElementsInCompoundT : CompoundT $\rightarrow$ set of ElementT.
\newline
ElementsInCompound(C) $\equiv$ $\cup$ \{ m : MoleculeT $\vert$ m $\in$ C $\cdot$ m.element\}\\
\newline
6. ElementsInChemicalEq : ChemicalEqT $\rightarrow$ set of ElementT.
\newline
ElementsInChemicalEq(Ce) $\equiv$ $\cup$ \{ C : CompoundT $\vert$ C $\in$ Ce $\cdot$ ElementsInCompound(C)\}\\
\newline
7. IsBalancedReactionForElement : ReactionT x ElementT $\rightarrow$ B 
\newline
IsBalancedReactionForElement (R, e) $\equiv$ Number-of-Atoms-in-ChemicalEq(R[0],e) = Number-of-Atoms-in-ChemicalEq (R[1] ,e )\\ 
\newline
8. IsBalanced-Reaction : ReactionT  $\rightarrow$ B 
\newline
IsBalanced-Reaction(R) $\equiv$ $\forall$ ( e :  ElementT $\vert$ e $\in$ ElementsInChemicalEq(R[0]) $\cdot$ IsBalancedReactionForElement(R, e))


\newpage
  
\section{MIS of Mass Calculation Module} \label{Mass} 

\subsection{Module}

Mass

\subsection{Uses}

Input (Section \ref{input}) , Atomic Mass (Section \ref{Atomic Mass}) , Reaction (Section \ref{Reaction}) 

\subsection{Syntax}

\subsubsection{Exported Constants}

None.

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
{Get-Molecular-weight} & Atomic-Mass: $\mathbb{R}$
  \newline Number-of-Atoms-in-Compound: $\mathbb{N}$ & Molecular-Weight:$\mathbb{R}$ & - \\
\hline
{Convert-Mass-to-Mole1}  & Mass1: $\mathbb{R}$
  \newline Molecular-Weight1: $\mathbb{R}$ & Mole1: $\mathbb{R}$  & Mass $\leq$ 0\\
\hline
{Get-Mole-Ratio}  & Coefficient1 : $\mathbb{N}$
  \newline Coefficient2 : $\mathbb{N}$ & Mole-Ratio: $\mathbb{N}$  & - \\
  \hline
{Convert-MoleRatio-to-Mole2} & Mole1: $\mathbb{R}$
  \newline Mole-Ratio: $\mathbb{R}$ & Mole2: $\mathbb{R}$ & - \\
 \hline
 {Convert-Mole-to-Mass} & Mole2: $\mathbb{R}$
  \newline Molecular-Weight2: $\mathbb{R}$ & Mass2:$\mathbb{R}$ & - \\
\hline
\end{tabular}
\end{center}

\wss{Since you have a function for atomic mass of an element, you don't need
  atomic mass as an input for Get-Molecular-weight.  Given a molecule, you can
  just calculate its weight.  You have all of the information you need inside
  the module.}
\wss{Several ADTs are missing.  You need to define ElementT, MoleculeT,
  CompoundT, StoichiometricT and ChemicalEqT.  When I mentioned ReactionT, that
  was just one example of the types that you need.}

\subsection{Semantics}

\subsubsection{State Variables}

None


\subsubsection{Environment Variables}

None

\subsubsection{Assumptions}

None

\subsubsection{Access Routine Semantics}

\noindent Get-Molecular-weight(Atomic-Mass,Number-of-Atoms-in-Compound):
\begin{itemize}
\item transition: None
\item output: out $\coloneqq$  Atomic-Mass $\times$ Number-of-Atoms-in-Compound
\item exception: None 
\end{itemize}

\noindent Convert-Mass-to-Mole(Mass1, Molecular-Weight1):
\begin{itemize}
\item transition: None
\item output: Mole1 $\coloneqq$  $\frac{Mass1}{Molecular-Weight1}$
\item exception: exc $\coloneqq$ (Mass1 $\leq$ 0 $\Rightarrow$ NegativeMassException) 
\end{itemize}

\noindent Get-Mole-Ratio(Coefficient2, Coefficient1):
\begin{itemize}
\item transition: None
\item output: out $\coloneqq$ $\frac{Coefficient2}{Coefficient1}$
\item exception: None 
\end{itemize}

\noindent Convert-MoleRatio-to-Mole(Mole1, Mole-Ratio):
\begin{itemize}
\item transition: None
\item output:  Mole2 $\coloneqq$ $\frac{Mole1}{Mole-Ratio}$
\item exception: None 
\end{itemize}

\noindent Convert-Mole-to-Mass(Mole2, Molecular-Weight2 ):
\begin{itemize}
\item transition: None
\item output:  Mass2 $\coloneqq$ $\frac{Mole2}{Molecular-weight2}$
\item exception: None 
\end{itemize}

\subsubsection{Local Functions}
None

\newpage

\section{MIS of GUI Module} \label{display} 

\subsection{Module}

GUI \wss{I discussed the purpose of the GUI module under the topic of the Input
  module.}

\subsection{Uses}

Reaction (Section \ref{Reaction}) , Mass (Section \ref{Mass})


\subsection{Syntax}

\subsubsection{Exported Constants}

None.

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
{GUI} & - & Mass: $\mathbb{R}$ \newline Reaction*: ReactionT & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

Not Applicable.

\wss{Further Notes on the missing parts of the design:}
\wss{I also think you need an ADT for Sets.  If you want to work without sets,
  you probably can, but they would nicely connect your SRS and your MIS.
  Defining a generic ADT for sets would be straightforward, but you don't even
  need to do that.  The only sets you will have will be sets of elements, so you
  could define an ADT for sets of elements.  You don't need to implement
  everything that sets have for operations, but you would need a test for
  equality.}
\wss{If you find the idea of sets confusing and you don't want all of the ADTs
  (MoleculeT etc) I mentioned above, I believe that you can come up with a
  design that works.  It is critical though that you have an ElementT.  You
  can't just assume it.  You also need a way to identify the coefficients that
  you are solving for.  The goal for the next step is to be able to write code,
  but I don't think you know how you are going to balance your equations.
  Without coefficients you cannot explain what balancing an equation means.}

%\section*{References}
\newpage 
\bibliographystyle {plainnat}
\bibliography{../../../refs/References}

\end{document}
